<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>OMNI Â· CORE</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />

<style>
/* === YOUR ORIGINAL CORE CSS (UNCHANGED) === */
:root{
  --bg:#000;
  --fg:#fff;
  --muted:rgba(255,255,255,.42);
  --accent:hsl(215 85% 58%);
  --accent-soft:hsl(215 85% 58% / .35);
  --focus:.5;
  --line-width:220px;
  --line-core-alpha:.62;
  --line-halo-alpha:.26;
  --line-halo:18px;
  --grain:.035;
  --tap:0;
}
*{box-sizing:border-box}
html,body{height:100%;margin:0}
html{color-scheme:dark}
body{
  background:radial-gradient(circle at 50% 40%, #06070a, #000 60%);
  color:var(--fg);
  font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial,sans-serif;
  display:flex;
  align-items:center;
  justify-content:center;
  overflow:hidden;
}
body::after{
  content:"";
  position:fixed;
  top:0;bottom:0;left:50%;
  width:1px;
  background:linear-gradient(to bottom,transparent,var(--accent-soft),transparent);
  opacity:calc(.25 + var(--tap)*.35);
  transform:translateX(-.5px);
}
body::before{
  content:"";
  position:fixed;
  inset:0;
  background:repeating-linear-gradient(
    0deg,
    rgba(255,255,255,.015),
    rgba(255,255,255,.015) 1px,
    transparent 1px,
    transparent 3px
  );
  opacity:var(--grain);
}
.center{text-align:center}
.omni-mark{
  width:26px;height:26px;
  margin:0 auto 10px;
  border-radius:50%;
  position:relative;
}
.omni-mark::after{
  content:"";
  position:absolute;inset:7px;
  border-radius:50%;
  background:var(--accent);
  filter:blur(6px);
  opacity:calc(.35 + var(--focus)*.6);
  animation:breath 5.5s ease-in-out infinite;
}
@keyframes breath{
  0%,100%{transform:scale(.92)}
  50%{transform:scale(1.08)}
}
.status{
  font-size:15px;
  letter-spacing:.08em;
  text-transform:uppercase;
}
.field{
  margin:22px auto 0;
  width:var(--line-width);
  height:1px;
  background:linear-gradient(to right,transparent,var(--accent),transparent);
}
</style>
</head>

<body>

<div class="center">
  <div class="omni-mark"></div>
  <div class="status" id="status">adaptive equilibrium</div>
  <div class="field"></div>
</div>

<script>
/* ===============================
   OMNI CORE BRAIN v58
=============================== */
(()=>{
"use strict";

const HALF=.5;
const clamp=x=>x<0?0:x>1?1:x;
const BRAIN_KEY="omni_brain_core";

const brain = JSON.parse(localStorage.getItem(BRAIN_KEY)) || {
  core:{mood:HALF,energy:HALF,curiosity:HALF,intent:HALF,attention:HALF},
  meta:{sessions:0,time:0,interactions:0},
  concepts:{},
  last:{search:null}
};

brain.meta.sessions++;

function save(){
  localStorage.setItem(BRAIN_KEY,JSON.stringify(brain));
}

function reinforceConcept(label){
  if(!brain.concepts[label]){
    brain.concepts[label]={label,count:0,weight:.2,last:Date.now()};
  }
  const c=brain.concepts[label];
  c.count++;
  c.weight=Math.min(1,c.weight+.15);
  c.last=Date.now();
  brain.last.search=label;
}

function decay(){
  const now=Date.now();
  Object.values(brain.concepts).forEach(c=>{
    c.weight*=Math.exp(-(now-c.last)/(1000*60*60*6));
    if(c.weight<.04) delete brain.concepts[c.label];
  });
}

function summary(){
  const top=Object.values(brain.concepts)
    .sort((a,b)=>b.weight-a.weight)
    .slice(0,3)
    .map(c=>c.label.toUpperCase());

  localStorage.setItem("omni_brain_summary",JSON.stringify({
    top,
    focus:brain.last.search,
    attention:brain.core.attention,
    mood:brain.core.mood
  }));

  return top;
}

/* LIVE MESSAGE BRIDGE */
window.addEventListener("message",e=>{
  const m=e.data;
  if(!m||m.source!=="omni-index")return;

  if(m.type==="intent") reinforceConcept(m.value);
  if(m.type==="submit") reinforceConcept(m.value);

  brain.core.attention=clamp(brain.core.attention+.08);
  decay();
  const top=summary();
  save();

  e.source.postMessage({
    source:"omni-core",
    type:"summary",
    top
  },"*");
});

setInterval(()=>{
  decay();
  summary();
  save();
},1200);

})();
</script>

</body>
</html>
