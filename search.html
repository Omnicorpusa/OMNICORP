<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<title>OMNI Search</title>
<meta name="viewport" content="width=device-width, initial-scale=1"/>

<style>
:root{
  --bg:#ffffff;
  --fg:#0b0b0d;
  --muted:rgba(11,11,13,.55);
  --line:rgba(11,11,13,.18);
}

@media (prefers-color-scheme: dark){
  :root{
    --bg:#000000;
    --fg:#ffffff;
    --muted:rgba(255,255,255,.55);
    --line:rgba(255,255,255,.18);
  }
  html{ color-scheme:dark; }
}

*{ box-sizing:border-box; }
html,body{ height:100%; margin:0; }

body{
  background:var(--bg);
  color:var(--fg);
  font-family:system-ui,-apple-system,BlinkMacSystemFont,
    "Segoe UI",Roboto,Helvetica,Arial,sans-serif;
  display:flex;
  align-items:center;
  justify-content:center;
}

.container{
  width:100%;
  max-width:640px;
  padding:40px 20px;
  text-align:center;
}

/* Search */
.search-input{
  width:100%;
  padding:14px 18px;
  border-radius:999px;
  border:1px solid var(--line);
  background:transparent;
  color:var(--fg);
  font-size:14px;
  text-align:center;
  outline:none;
}

.search-input::placeholder{
  color:var(--muted);
}

.search-input:focus{
  border-color:var(--fg);
  box-shadow:0 0 0 1px var(--fg);
}

/* Output */
.status{
  margin-top:26px;
  font-size:12px;
  letter-spacing:.06em;
  color:var(--muted);
}
</style>
</head>

<body>

<div class="container">

  <form method="get" action="search.html">
    <input
      id="query"
      class="search-input"
      type="search"
      name="q"
      placeholder="SEARCH OMNI"
      autocomplete="off"
      autofocus
    />
  </form>

  <div class="status" id="status"></div>

</div>

<script>
/* ───────── OMNI BRAIN v2 ───────── */

const OMNI_BRAIN_DEFAULT = {
  meta:{
    created:Date.now(),
    version:2,
    totalSearches:0
  },
  concepts:{},
  presence:{ lastSearch:null }
};

function loadBrain(){
  try{
    const b = JSON.parse(localStorage.getItem("omni_brain"));
    if(b && typeof b === "object") return b;
  }catch(e){}
  return structuredClone(OMNI_BRAIN_DEFAULT);
}

function saveBrain(brain){
  localStorage.setItem("omni_brain", JSON.stringify(brain));
}

function normalize(text){
  return text.toLowerCase().trim()
    .replace(/[^\w\s]/g,"")
    .replace(/\s+/g," ");
}

function reinforce(brain, label){
  const now = Date.now();

  if(!brain.concepts[label]){
    brain.concepts[label] = {
      label,
      count:0,
      weight:0.25,
      firstSeen:now,
      lastSeen:now
    };
  }

  const c = brain.concepts[label];
  c.count++;
  c.weight = Math.min(1, c.weight + 0.15 * (1 - c.weight));
  c.lastSeen = now;
}

function decay(brain){
  const now = Date.now();
  const HALF_LIFE = 1000 * 60 * 60 * 6;

  Object.values(brain.concepts).forEach(c=>{
    const age = now - c.lastSeen;
    c.weight *= Math.exp(-age / HALF_LIFE);
    if(c.weight < 0.05) delete brain.concepts[c.label];
  });
}

/* ───────── Init ───────── */

const brain = loadBrain();
decay(brain);

const params = new URLSearchParams(window.location.search);
const q = params.get("q");

const input = document.getElementById("query");
const status = document.getElementById("status");

if(q){
  const concept = normalize(q);
  input.value = q;

  brain.meta.totalSearches++;
  brain.presence.lastSearch = Date.now();

  reinforce(brain, concept);
  saveBrain(brain);

  status.textContent =
    `CONCEPT ACTIVE · ${concept.toUpperCase()}`;
}else{
  status.textContent = "ENTER A QUERY";
}
</script>

</body>
</html>
